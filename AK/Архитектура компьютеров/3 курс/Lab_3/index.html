<!doctype html>
<html>
<head><meta charset="utf-8"><link rel=stylesheet href="../style.css"><title>FPU x87</title>
</head>
<body>
<a href="../index.html">Содержание</a>
<h1>Лабораторная работа 3. Блок вычислений с плавающей точкой FPU x87</h1>
<hr>
<h2>3.1. Цель работы</h2>
<p>Углубление и закрепление знаний архитектуры блока вычислений с плавающей точкой FPU x87; получение практических навыков по составлению программ для FPU x87 на языке ассемблера, их отладке и выполнению.</p>
<h2>3.2	Самостоятельная работа студентов</h2>
<p>Перед выполнением лабораторной работы студенты должны изучить регистровую модель FPU x87, форматы данных и особые случаи представления данных, ознакомиться с системой ассемблерных команд FPU (<a target="_blank" href="../CA_appendix.pdf#%5B%7B%22num%22%3A64%2C%22gen%22%3A0%7D%2C%7B%22name%22%3A%22XYZ%22%7D%2C54%2C790%2C0%5D">приложение Б</a>). Выполнение заданий данной лабораторной работы предполагает наличие у студентов знаний и навыков, полученных и закрепленных в ходе выполнения <a href="../Lab_2/index.html">лабораторной работы 2</a> («Архитектура прикладного уровня CPU x86-64»).</p></p>
<p><p>При подготовке к выполнению практических заданий следует обратить особое внимание на группы команд передачи данных, арифметические команды и команды сравнения.</p>
<p>С целью получения практических навыков по реализации операций FPU необходимо составить программы в соответствии с вариантом заданий (п. 3.5) и исследовать функционирование FPU, выполняя разработанную программу в пошаговом режиме (под управлением отладчика).</p>

<h2>3.3	Примеры выполнения практических заданий</h2>
<p>3.3.1 Вычислить значение функции S = (1/2)*A*B*sin(&alpha;).</p>
<listing>
void main ()				// начало программы на языке С++
{					// описание операндов в памяти
	long	A=20, B=30, M2=2;
	float	ALPHA=0.7, Y;

	_asm
	{				; начало ассемблерной вставки
	finit				; очистка регистров FPU
	fld	 ALPHA			; загрузка аргумента в стек FPU
	fsin				; вычисление синуса
	fimul	 A			; умножение ST(0) на целое A
	fimul	 B			; умножение ST(0) на целое B
	fidiv	 M2			; деление ST(0) на целое M2
	fstp	 Y			; сохранение результата в ячейке памяти
	} 				// окончание ассемблерной вставки
}					// окончание программы на языке С++
</listing>
<p></p>
<p>3.3.2 Вычислить площадь треугольника по формуле Герона  , где p – полупериметр треугольника.</p>
<listing>
void main ()				// начало программы на языке С++
{
	long	 A=20, B=30, C=40, M2=2;// описание операндов в памяти
	float	 RES;			// ячейка памяти для результата

	_asm
	{				; начало ассемблерной вставки
	finit				; очистка регистров FPU
	fild	A			;
	fild	B			;
	fild	C			;
	fld	ST			; C -> ST(0)
	fadd	ST,ST(2)		; C + B
	fadd	ST,ST(3)		; C + B + A
	fidiv	M2			; (C + B + A) / 2 -> ST(0) (p)
	fsubr	ST(1),ST		; (p-C)-> ST(1)
	fsubr	ST(2),ST		; (p-B)-> ST(2)
	fsubr	ST(3),ST		; (p-A)-> ST(3)
	fmul				; p*(p-C)
	fmul				; p*(p-C)*(p-B)
	fmul				; p*(p-C)*(p-B)*(p-A)
	fsqrt				; (p*(p-C)*(p-B)*(p-A))^(1/2)
	fstp	RES			; сохранение результата и очистка ST(0)
	}				// окончание ассемблерной вставки
}					// окончание программы на языке С++
</listing>
<p></p>
<p>3.3.3 Определить номер (n) элемента последовательности a<sub>n</sub> = 5,3^n + 5*n, при котором сумма элементов превысит 20000.</p>
<listing>
void main ()				// начало программы на языке С++
{
	float	 A=5.3;			// описание операндов в памяти
	long	 B=5, C=20000, N=0;

	_asm
	{				; начало ассемблерной вставки
	finit				; очистка регистров FPU
	fld1				; подготовка к вычислению степенной функции
	fldz				; подготовка к накоплению суммы прогрессии
m1:	inc	N			; наращивание аргумента
	fld	A			; загрузка 5,3 в стек FPU
	fmulp	ST(2),ST		; вычисление степенной функции 5,3^n
	fild	B
	fimul	N
	fadd	ST,ST(2)		; вычисление элемента последовательности
	fadd				; накопление суммы последовательности
	ficom	C			; сравнение суммы с 20000
	fstsw	AX			; сохранение копии регистра состояния SW
					; в регистре AX (CPU)
	sahf				; сохранение старшего байта АХ в EFLAGS
	jc	m1			; переход, если сумма меньше 20000
	}				// окончание ассемблерной вставки
}					// окончание программы на языке С++
</listing>
<p></p>
<p>3.3.4 Вычислить функцию Y = 5 * arcSin ((tg 60°)2/ 7). Результат перевести в градусы.</p>
<p></p>
<listing>
void main ()				// начало программы на языке С++
{
	long	 A=60, B=5, C=7, D=180;	// описание операндов в памяти
	float	 Y;

	_asm{				; начало ассемблерной вставки
	finit				; очистка регистров FPU
	fldpi				; загрузка константы «пи» в стек FPU
	fimul	A			; умножение числа «пи» на аргумент
	fidiv	D			; деление аргумента на 180
	fptan				; вычисление частичного тангенса
	fdiv				; нахождение тангенса
	fmul	ST,ST			; возведение в квадрат
	fidiv	C			; вычислен «z» – аргумент ArcSin
	fld	ST			; копирование вершины стека
	fmul	ST,ST			; возведение в квадрат
	fld1				; загрузка 1 в стек FPU
	fsubr				; вычитание с реверсом: 1 – z^2
	fsqrt				; корень квадратный
	fpatan				; вычисление арктангенса
	fimul	B			; умножение на константу
	fldpi				;
	fdiv				; перевод из радианов – в градусы
	fimul	D			;
	fstp	Y			; сохранение результата в ячейке памяти
	}				// окончание ассемблерной вставки
}					// окончание программы на языке С++
</listing>
<p></p>
<p>3.3.5 Возведение основания 2 в произвольную степень.</p>
<listing>
	; фрагмент ассемблерной вставки:
	;  - аргумент z находится на вершине стека
	;  - результат 2^z будет помещен на вершину стека

	fld	ST(0)			; копирование вершины стека
	frndint				; округление ST(0) до целого
	fsub	ST(1),ST(0) 		; выделение дробной части в ST(1)
	fxch				; обмен регистров ST(0) и ST(1)
	f2xm1				; возведение 2 в дробную степень (минус 1)
	fld1				; загрузка  1 в стек FPU
	fadd				; добавление единицы
	fscale				; возведение 2 в целую степень и умножение
	fstp	ST(1)			; удаление регистра и сдвиг вершины,
	
	; результат находится на вершине стека		
</listing>
<p></p>
<h2>3.4	Порядок выполнения работы</h2>
<p>Выполнение работы состоит в разработке, отладке и выполнении ассемблерных программ для FPU x87 в среде разработки Visual C++. Основные этапы работы в среде Visual C++ рассмотрены в <a href="../Lab_2/index.html#p2_4">лабораторной работе 2 (п. 2.4)</a>.</p>
<p>Программы выполняются в пошаговом режиме (под управлением отладчика) с одновременным контролем промежуточных результатов в регистровом стеке FPU. С этой целью, в окне отладки «Registers» необходимо выбрать для отображения (в дополнение к компонентам программной модели CPU) компонент «Floating Point» (рис. 3.1).</p>
<p>Для задания 1 необходимо построить диаграмму стека FPU на какой-либо итерации цикла выполнения программы по образцу, приведенному на рис. 3.2. Диаграмма должна отражать изменения состояния стека после каждой команды FPU. Таким образом, в нее необходимо включить команды FPU в порядке их появления в программе. Рекомендуется указывать значение мантиссы с точностью 3 разрядов после десятичной точки, значение порядка – 1 знак.</p>
<p>Результаты вычислений, сохраняемые в памяти, рекомендуется контролировать посредством элементов «Memory n» меню отладки «Memory» (рисунок 3.3; для представления результатов в окне «Memory 2» выбран формат «32-bit Floating Point»).</p>
<p>Исходные данные и результаты выполнения программ представить в десятичном (с плавающей точкой) и шестнадцатеричном форматах.</p>
<p class="center"><img src="fig_3_1.png" alt="Рисунко 3.1" /></p>
<p class="center">Рисунок 3.1 – Окно отладки «Registers»</p>
<div class="center">
<table>
<tr><th rowspan="2" width="100px">Стек FPU</th><th colspan="6" width="600px">Команды FPU</th></tr>
<tr></th><th>finit</th><th>fild A</th><th>fild B</th><th>fild C</th><th>fld ST</th><th>fadd ST,ST(2)</th></tr>
<tr><td>ST(0)</td><td>0.000e0</td><td>2.000e1</td><td>3.000e1</td><td>4.000e1</td><td>4.000e1</td><td>7.000e1</td></tr>
<tr><td>ST(1)</td><td>0.000e0</td><td>0.000e0</td><td>2.000e1</td><td>3.000e1</td><td>4.000e1</td><td>4.000e1</td></tr>
<tr><td>ST(2)</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>2.000e1</td><td>3.000e1</td><td>3.000e1</td></tr>
<tr><td>ST(3)</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>2.000e1</td><td>2.000e1</td></tr>
<tr><td>ST(4)</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td></tr>
<tr><td>ST(5)</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td></tr>
<tr><td>ST(6)</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td></tr>
<tr><td>ST(7)</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td></tr>
<tr><td>Тэги</td><td>FFFF</td><td>3FFF</td><td>0FFF</td><td>03FF</td><td>00FF</td><td>00FF</td></tr>
</table>
</div>
<div class="center">
<table>
<tr><th rowspan="2" width="100px">Стек FPU</th><th colspan="6" width="600px">Команды FPU</th></tr>
<tr><th>fadd ST,ST(3)</th><th>fidiv M2</th><th>fsubr ST(1),ST</th><th>fsubr ST(2),ST</th><th>fsubr ST(3),ST</th><th>fmul</th></tr>
<tr><td>ST(0)</td><td>9.000e1</td><td>4.500e1</td><td>4.500e1</td><td>4.500e1</td><td>4.500e1</td><td>2.250e2</td></tr>
<tr><td>ST(1)</td><td>4.000e1</td><td>4.000e1</td><td>5.000e1</td><td>5.000e1</td><td>5.000e1</td><td>1.500e1</td></tr>
<tr><td>ST(2)</td><td>3.000e1</td><td>3.000e1</td><td>3.000e1</td><td>1.500e1</td><td>1.500e1</td><td>2.500e1</td></tr>
<tr><td>ST(3)</td><td>2.000e1</td><td>2.000e1</td><td>2.000e1</td><td>2.000e1</td><td>2.500e1</td><td>0.000e0</td></tr>
<tr><td>ST(4)</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td></tr>
<tr><td>ST(5)</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td></tr>
<tr><td>ST(6)</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td></tr>
<tr><td>ST(7)</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>4.500e1</td></tr>
<tr><td>Тэги</td><td>00FF</td><td>00FF</td><td>00FF</td><td>00FF</td><td>00FF</td><td>03FF</td></tr>
</table>
</div>
<p></p>
<div class="center">
<table>
<tr><th rowspan="2" width="100px">Стек FPU</th><th colspan="4" width="600px">Команды FPU</th></tr>
<tr><th>fmul</th><th>fmul</th><th>fsqrt</th><th>fstp RES</th></tr>
<tr><td>ST(0)</td><td>3.375e3</td><td>8.438e4</td><td>2.905e2</td><td>0.000e0</td></tr>
<tr><td>ST(1)</td><td>2.500e1</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td></tr>
<tr><td>ST(2)</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td></tr>
<tr><td>ST(3)</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td></tr>
<tr><td>ST(4)</td><td>0.000e0</td><td>0.000e0</td><td>0.000e0</td><td>4.500e1</td></tr>
<tr><td>ST(5)</td><td>0.000e0</td><td>4.500e1</td><td>4.500e1</td><td>2.250e2</td></tr>
<tr><td>ST(6)</td><td>4.500e1</td><td>2.250e2</td><td>2.250e2</td><td>3.375e3</td></tr>
<tr><td>ST(7)</td><td>2.250e2</td><td>3.375e3</td><td>3.375e3</td><td>2.905e2</td></tr>
<tr><td>Тэги</td><td>0FFF</td><td>3FFF</td><td>3FFF</td><td>FFFF</td></tr>
</table>
</div>
<p class="center">Рисунок 3.2 – Изменение стека FPU</p>

<p class="center"><img src="fig_3_3.png" alt="Рисунко 3.3" /></p>
<p class="center">Рисунок 3.3 – Выбор областей памяти</p>


<h2>3.5	Варианты индивидуальных заданий</h2>

<h4>3.5.1 Исследование выполнения арифметических операций.</h4>
<p><u>Вариант 1.</u> Вычислить 6 значений функции Y = 3,5 * x^2 + 7,2 * x (х изменяется от 4,5 с шагом 3). Результат округлить до целого и разместить в памяти.</p>
<p><u>Вариант 2.</u> Вычислить 5 значений суммы элементов последовательности a<sub>n</sub> = 2,5 * n^2 + 5,3 (для n от 4 с шагом 1). Результат разместить в памяти в целом формате.</p>
<p><u>Вариант 3.</u> Вычислить 7 значений функции Y = 2500 / (2 * х^2 + 3,7) (х изменяется от 3 с шагом 2,5). Результат округлить до целого и разместить в памяти.</p>
<p><u>Вариант 4.</u> Вычислить 6 значений функции Y = (14 * x + 5,6)^(1/2) (x изменяется от 6 с шагом 3). Результат разместить в памяти.</p>
<p><u>Вариант 5.</u> Вычислить 6 значений функции Y = (20 * x) / (5 * x^2 – 8,5) (x изменяется от 1 с шагом 4). Результат разместить в памяти.</p>
<p><u>Вариант 6.</u> Вычислить 6 значений суммы элементов последовательности a<sub>n</sub> = (4,5^n) / (n + 5) (для n от 1 с шагом 1). Результат округлить до целого и разместить в памяти.</p>
<p><u>Вариант 7.</u> Вычислить 5 значений функции Y = (x - 7) / [(x + 20)^(1/2)]  (x изменяется от 3 с шагом 2,5). Результат разместить в памяти.</p>
<p><u>Вариант 8.</u> Вычислить 6 значений функции Y = 1024 / (3,2 * x^2 – 25), (x изменяется от 2 с шагом 2). Результат разместить в памяти.</p>
<p><u>Вариант 9.</u> Вычислить 5 значений суммы суммы элементов последовательности an = 418 / (2 * n^2 + 7,3), (для n от 1 с шагом 1). Результат разместить в памяти.</p>
<p><u>Вариант 10.</u> Вычислить 6 значений функции Y = 3000 / (x^2 + 3,6 * x – 7,5), (x изменяется от 2 с шагом 2,7). Результат разместить в памяти.</p>

<h4>3.5.2 Исследование выполнения операций сравнения. </h4>
<p><u>Вариант 1.</u> Найти целое значение аргумента, при котором функция Y = 20 / (x^2 + 2,5^x) станет меньше 0,2.</p>
<p><u>Вариант 2.</u> Найти целое значение аргумента х, при котором функция Y = 15 / (x^2 + 3,7) станет меньше 0,1 (для х от 1 с шагом 1).</p>
<p><u>Вариант 3.</u> Определить номер (n) элемента последовательности a<sub>n</sub> = 2,5 * n2 + 7,3, при котором сумма элементов последовательности превысит 1000.</p>
<p><u>Вариант 4.</u> Определить номер (n) элемента последовательности a<sub>n</sub> = 3,3^n + 5, при котором сумма элементов последовательности превысит 15000.</p>
<p><u>Вариант 5.</u> Задан массив с элементами a(i) = sin (5 * i). Определить номер элемента массива, при котором сумма элементов превысит 3. Аргумент синуса задан в градусах.</p>
<p><u>Вариант 6.</u> Найти целое значение аргумента, при котором функция Y = (2,5 * x + 10)^(1/2) превысит 100.</p>
<p><u>Вариант 7.</u> Определить номер (n) элемента прогрессии Y = (2,5 + 3 * n)^(1/2), при котором сумма элементов превысит 100.</p>
<p><u>Вариант 8.</u> Задан массив с элементами b(i) = sin(2 * i^2). Определить номер элемента, при котором сумма элементов превысит 3. Аргумент синуса задан в градусах.</p>
<p><u>Вариант 9.</u> Найти целое значение аргумента, при котором функция Y = (5,6^x) / (3 * x^2) превысит 200.</p>
<p><u>Вариант 10.</u> Найти целое значение аргумента х, при котором функция Y = (15 * x + 32 * x + 40)^(1/2) превысит 30.</p>
<p></p>
<h4>3.5.3 Исследование выполнения команд с обратными тригонометрическими функциями.</h4> <p>Вычислить одно значение функции Y. Параметры аргументов выбирать с учетом области определения. Результат перевести в градусы.</p>
<p></p>
<p><u>Вариант 1.</u> Y = 3 * arcSin (2 * cos(70°))^2.</p>
<p><u>Вариант 2.</u> Y = (1/2) * arcCosec (3 * A^2 + 4 * B).</p>
<p><u>Вариант 3.</u> Y = 2 * arcSin ((A^2 + B^2 )/3).</p>
<p><u>Вариант 4.</u> Y = 3 * arcCos (2 * A^2 - B).</p>
<p><u>Вариант 5.</u> Y = 5 * arcSec (3 * (tg 70°)^2).</p>
<p><u>Вариант 6.</u> Y = (1/3) * arcSin (3 * A + sin 20°).</p>
<p><u>Вариант 7.</u> Y = 4 * arcCos (2 * sin 30° * cos 30°).</p>
<p><u>Вариант 8.</u> Y = (1/4) * arcCosec ((5 * A + B^2)/2).</p>
<p><u>Вариант 9.</u> Y = 3 * arcCosec ( 4 * A + tg 40°).</p>
<p><u>Вариант 10.</u> Y = 5 * arcSin (3 * cos 25° * sin 25°).</p>
<p></p>
<h4>3.5.4 Исследование выполнения команд с логарифмическими и показательными функциями.</h4>
<p></p>
<p><u>Вариант 1.</u> Вычислить 6 значений функции Y = 5 * ln (sin x), x изменяется в градусах от 10 с шагом 15.</p>
<p><u>Вариант 2.</u> Вычислить 5 значений функции Y = 7^x, x изменяется от 0,5 с шагом 0,2.</p>
<p><u>Вариант 3.</u> Вычислить 7 значений функции Y = 4 * lg (tg x), x изменяется в градусах от 15 с шагом 10.</p>
<p><u>Вариант 4.</u> Вычислить 6 значений функции Y = 12^x, x изменяется от 0,5 с шагом 0,3.</p>
<p><u>Вариант 5.</u> Вычислить 5 значений функции Y = 3 * log<sub>8</sub>(x^2 +1), x изменяется от 0,2 с шагом 0,3.</p>
<p><u>Вариант 6.</u> Вычислить 7 значений функции Y = 5(sin x), x изменяется в градусах от 10 с шагом 8.</p>
<p><u>Вариант 7.</u> Вычислить 6 значений функции Y = 7 * ln [x^2 + x^(1/2)], x изменяется от 2 с шагом 3.</p>
<p><u>Вариант 8.</u> Вычислить 5 значений функции Y = 4^(x^2 + 1), x изменяется от 0,2 с шагом 0,4.</p>
<p><u>Вариант 9.</u> Вычислить 7 значений функции Y = 6 * lg (cos x), x изменяется в градусах от 8 с шагом 12.</p>
<p><u>Вариант 10.</u> Вычислить 6 значений функции Y = 3^(cos x), x изменяется в градусах от 10 с шагом 8.</p>

<h2>3.6 Содержание отчета</h2>

<p>Отчет о лабораторной работе должен содержать:
<ul>
<li>цель работы;</li>
<li>краткое описание теоретических основ;</li>
<li>постановку задачи;</li>
<li>экспериментально-практическую часть (включая анализ результатов);</li>
<li>выводы по работе.</li>
</ul>
<p>
<p>В экспериментально-практической части необходимо привести исходные тексты разработанных программ (на языке C++ с ассемблерными вставками) и результаты их выполнения, полученные в регистрах FPU и (или) ячейках памяти.</p>

<h2>3.7 Контрольные вопросы</h2>
<ol>
<li>Приведите форматы данных, обрабатываемых FPU.</li>
<li>Что представляет собой регистровая модель блока FPU?</li>
<li>Каким образом адресуются регистры данных FPU?</li>
<li>Поясните принцип выполнения двухоперандных арифметических команд FPU.</li>
<li>Перечислите особые случаи представления вещественных чисел.</li>
<li>Какие особые случаи различают в работе FPU?</li>
<li>Что представляет собой мнемоника команд FPU?</li>
<li>Назовите основные группы команд FPU и объясните их назначение.</li>
<li>Как реализуются ветвления на основе анализа значений данных FPU?</li>
</ol>

</body>
</html>
